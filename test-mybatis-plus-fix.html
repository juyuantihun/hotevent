<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyBatis-Plus查询修复测试</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #409eff;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 10px 0;
        }
        .success {
            color: #67c23a;
            font-weight: bold;
        }
        .warning {
            color: #e6a23c;
            font-weight: bold;
        }
        .error {
            color: #f56c6c;
            font-weight: bold;
        }
        .comparison {
            display: flex;
            gap: 20px;
            margin: 15px 0;
        }
        .before, .after {
            flex: 1;
            padding: 15px;
            border-radius: 6px;
        }
        .before {
            background: #fef0f0;
            border: 1px solid #fbc4c4;
        }
        .after {
            background: #f0f9ff;
            border: 1px solid #bfdbfe;
        }
    </style>
</head>
<body>
    <h1>MyBatis-Plus查询修复测试</h1>
    
    <div class="test-section">
        <h2>问题描述</h2>
        <p>在 <code>GeographicEnhancementController</code> 中使用了错误的 MyBatis-Plus 查询语法：</p>
        <div class="code-block error">
The method lambdaQuery() is undefined for the type QueryWrapper
        </div>
    </div>

    <div class="test-section">
        <h2>修复方案</h2>
        
        <div class="comparison">
            <div class="before">
                <h4>修复前（错误）</h4>
                <div class="code-block">
// 错误的用法
QueryWrapper.&lt;Event&gt;lambdaQuery()
    .and(wrapper -&gt; wrapper
        .isNull(Event::getLatitude)
        .or()
        .isNull(Event::getLongitude)
        .or()
        .eq(Event::getGeographicStatus, 0))
    .last("LIMIT " + limit)
                </div>
            </div>
            <div class="after">
                <h4>修复后（正确）</h4>
                <div class="code-block">
// 正确的用法
new LambdaQueryWrapper&lt;Event&gt;()
    .and(wrapper -&gt; wrapper
        .isNull(Event::getLatitude)
        .or()
        .isNull(Event::getLongitude)
        .or()
        .eq(Event::getGeographicStatus, 0))
    .last("LIMIT " + limit)
                </div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>修复详情</h2>
        
        <h3>1. 导入正确的类</h3>
        <div class="code-block">
import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
        </div>

        <h3>2. 使用正确的构造方式</h3>
        <p>MyBatis-Plus 中有两种主要的查询包装器：</p>
        <ul>
            <li><span class="success">QueryWrapper</span>：基于字符串的查询条件</li>
            <li><span class="success">LambdaQueryWrapper</span>：基于Lambda表达式的类型安全查询</li>
        </ul>

        <h3>3. 正确的使用方式</h3>
        <div class="code-block">
// 方式1：直接创建LambdaQueryWrapper
new LambdaQueryWrapper&lt;Event&gt;()

// 方式2：通过Wrappers工具类创建
Wrappers.&lt;Event&gt;lambdaQuery()

// 方式3：通过QueryWrapper创建（如果需要）
new QueryWrapper&lt;Event&gt;().lambda()
        </div>
    </div>

    <div class="test-section">
        <h2>查询逻辑说明</h2>
        <p>修复后的查询逻辑用于查找需要地理信息增强的事件：</p>
        
        <div class="code-block">
// 查询条件：
// 1. latitude 字段为空 OR
// 2. longitude 字段为空 OR  
// 3. geographic_status = 0 (未处理)
// 限制结果数量为指定的 limit

new LambdaQueryWrapper&lt;Event&gt;()
    .and(wrapper -&gt; wrapper
        .isNull(Event::getLatitude)      // 纬度为空
        .or()
        .isNull(Event::getLongitude)     // 或经度为空
        .or()
        .eq(Event::getGeographicStatus, 0) // 或地理状态为未处理
    )
    .last("LIMIT " + limit)              // 限制结果数量
        </div>
    </div>

    <div class="test-section">
        <h2>测试步骤</h2>
        <ol>
            <li><span class="success">编译检查</span>：确保项目能够正常编译</li>
            <li><span class="success">启动应用</span>：启动Spring Boot应用</li>
            <li><span class="success">测试API</span>：调用批量增强接口</li>
            <li><span class="success">验证查询</span>：确认能够正确查询到需要增强的事件</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>API测试命令</h2>
        <div class="code-block">
# 测试批量增强接口
curl -X POST "http://localhost:8080/api/geographic-enhancement/enhance-missing?limit=10"

# 预期响应格式
{
  "code": 200,
  "message": "批量地理信息增强完成",
  "data": {
    "processedCount": 5,
    "enhancedCount": 3,
    "statistics": "地理信息增强统计 - 总处理: 5, 成功增强: 3, ..."
  }
}
        </div>
    </div>

    <div class="test-section">
        <h2>常见的MyBatis-Plus查询模式</h2>
        
        <h3>Lambda查询（推荐）</h3>
        <div class="code-block">
// 类型安全，支持重构
LambdaQueryWrapper&lt;Event&gt; wrapper = new LambdaQueryWrapper&lt;&gt;();
wrapper.eq(Event::getStatus, 1)
       .like(Event::getEventLocation, "北京")
       .between(Event::getEventTime, startTime, endTime);
        </div>

        <h3>字符串查询</h3>
        <div class="code-block">
// 基于字符串，需要手动维护字段名
QueryWrapper&lt;Event&gt; wrapper = new QueryWrapper&lt;&gt;();
wrapper.eq("status", 1)
       .like("event_location", "北京")
       .between("event_time", startTime, endTime);
        </div>

        <h3>复杂条件组合</h3>
        <div class="code-block">
// 复杂的AND/OR组合
new LambdaQueryWrapper&lt;Event&gt;()
    .and(w -&gt; w.eq(Event::getStatus, 1).or().eq(Event::getStatus, 2))
    .and(w -&gt; w.isNotNull(Event::getLatitude).isNotNull(Event::getLongitude));
        </div>
    </div>

    <div class="test-section">
        <h2>验证要点</h2>
        <ul>
            <li><span class="success">✓</span> 项目编译无错误</li>
            <li><span class="success">✓</span> 应用启动正常</li>
            <li><span class="success">✓</span> API接口响应正常</li>
            <li><span class="success">✓</span> 查询逻辑正确执行</li>
            <li><span class="success">✓</span> 数据库查询结果符合预期</li>
        </ul>
    </div>

    <script>
        console.log('MyBatis-Plus查询修复测试页面已加载');
        console.log('请按照测试步骤验证修复效果');
    </script>
</body>
</html>