# 依赖和API更新计划

本文档详细说明了前端项目依赖包更新、安全漏洞修复和API使用优化的计划。

## 1. 安全漏洞修复

根据`npm audit`的结果，我们需要优先修复以下安全漏洞：

### 高危漏洞

1. **xlsx**: 存在原型污染和正则表达式拒绝服务(ReDoS)漏洞
   - 当前版本: 0.18.5
   - 需要更新到: 0.20.2或更高版本

### 中危漏洞

1. **vite**: 存在开发服务器安全漏洞
   - 当前版本: 4.4.9
   - 需要更新到: 7.0.5或更高版本

2. **@vitejs/plugin-vue**: 通过vite存在漏洞
   - 当前版本: 4.3.1
   - 需要更新到: 6.0.0或更高版本

3. **vue-tsc**: 存在XSS漏洞
   - 当前版本: 1.8.8
   - 需要更新到: 3.0.3或更高版本

## 2. 过时依赖更新

根据`npm outdated`的结果，以下依赖需要更新：

### 主要依赖

1. **pinia**: 2.3.1 → 3.0.3 (主版本更新)
2. **vue-echarts**: 6.7.3 → 7.0.3 (主版本更新)

### 开发依赖

1. **@types/node**: 20.19.8 → 24.0.14
2. **@typescript-eslint/eslint-plugin**: 6.21.0 → 8.37.0
3. **@typescript-eslint/parser**: 6.21.0 → 8.37.0
4. **@vue/tsconfig**: 0.4.0 → 0.7.0
5. **eslint**: 8.57.1 → 9.31.0
6. **eslint-plugin-vue**: 9.33.0 → 10.3.0
7. **tailwindcss**: 3.4.17 → 4.1.11
8. **typescript**: 5.1.6 → 5.8.3
9. **unplugin-auto-import**: 0.16.7 → 19.3.0
10. **unplugin-vue-components**: 0.25.2 → 28.8.0

## 3. 更新策略

由于存在多个主版本更新，我们将采用分阶段更新策略：

### 阶段1: 安全漏洞修复

1. 更新xlsx库以修复高危漏洞
2. 更新vue-tsc以修复中危漏洞

### 阶段2: 构建工具更新

1. 更新vite和相关插件
2. 更新TypeScript和相关工具

### 阶段3: 框架和库更新

1. 更新pinia状态管理库
2. 更新vue-echarts图表库

### 阶段4: 开发工具更新

1. 更新ESLint和相关插件
2. 更新其他开发依赖

## 4. API使用优化

### 现代JavaScript/TypeScript特性

1. 使用可选链操作符 (`?.`)
2. 使用空值合并操作符 (`??`)
3. 使用逻辑空赋值 (`??=`)
4. 使用现代数组方法 (如 `Array.prototype.at()`)

### Vue 3最佳实践

1. 使用`<script setup>`语法
2. 使用组合式API
3. 使用`defineProps`和`defineEmits`
4. 使用`v-bind`的简写语法

### Axios最佳实践

1. 使用请求和响应拦截器
2. 实现请求取消功能
3. 使用请求重试机制
4. 实现请求缓存

## 5. 兼容性考虑

1. 主版本更新可能包含破坏性变更，需要仔细阅读更新日志
2. 更新pinia可能需要调整状态管理代码
3. 更新TypeScript可能需要修复类型错误
4. 更新ESLint可能需要调整代码风格

## 6. 测试策略

1. 为每个阶段的更新创建单独的分支
2. 运行自动化测试确保功能正常
3. 进行手动测试验证关键功能
4. 检查构建过程是否正常

## 7. 回滚计划

1. 保存当前的package.json和package-lock.json
2. 记录每个阶段的更改
3. 准备回滚脚本
4. 设置监控以快速发现问题