<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>提示词模板更新测试</title>\n    <style>\n        body {\n            font-family: 'Microsoft YaHei', sans-serif;\n            max-width: 1000px;\n            margin: 0 auto;\n            padding: 20px;\n            line-height: 1.6;\n            background: #f8f9fa;\n        }\n        .header {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            padding: 30px;\n            border-radius: 12px;\n            text-align: center;\n            margin-bottom: 30px;\n        }\n        .test-section {\n            background: white;\n            padding: 25px;\n            margin: 20px 0;\n            border-radius: 10px;\n            box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n            border-left: 5px solid #409eff;\n        }\n        .api-test {\n            background: #f8f9fa;\n            padding: 20px;\n            border-radius: 8px;\n            margin: 15px 0;\n            border: 1px solid #dee2e6;\n        }\n        .code-block {\n            background: #2d3748;\n            color: #e2e8f0;\n            padding: 20px;\n            border-radius: 8px;\n            overflow-x: auto;\n            font-family: 'Consolas', 'Monaco', monospace;\n            margin: 15px 0;\n            font-size: 14px;\n        }\n        .success {\n            color: #67c23a;\n            font-weight: bold;\n        }\n        .warning {\n            color: #e6a23c;\n            font-weight: bold;\n        }\n        .error {\n            color: #f56c6c;\n            font-weight: bold;\n        }\n        .info {\n            color: #409eff;\n            font-weight: bold;\n        }\n        .highlight {\n            background: #fff3cd;\n            padding: 3px 6px;\n            border-radius: 4px;\n            font-weight: bold;\n            color: #856404;\n        }\n        .step {\n            background: #e8f5e8;\n            padding: 15px;\n            margin: 10px 0;\n            border-radius: 6px;\n            border-left: 4px solid #28a745;\n        }\n        .button {\n            background: #409eff;\n            color: white;\n            padding: 10px 20px;\n            border: none;\n            border-radius: 6px;\n            cursor: pointer;\n            margin: 5px;\n            font-size: 14px;\n        }\n        .button:hover {\n            background: #337ab7;\n        }\n        .result-area {\n            background: #f8f9fa;\n            padding: 15px;\n            border-radius: 6px;\n            margin: 10px 0;\n            min-height: 100px;\n            border: 1px solid #dee2e6;\n            font-family: monospace;\n            white-space: pre-wrap;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <h1>📝 提示词模板更新测试</h1>\n        <p>确保提示词模板包含经纬度要求的完整测试</p>\n    </div>\n\n    <div class=\"test-section\">\n        <h2>🎯 问题诊断</h2>\n        <p>根据日志分析，发现提示词中缺少经纬度要求：</p>\n        <div class=\"code-block\">\n2025-08-04 16:43:19 [http-nio-8080-exec-10] INFO  c.h.e.s.i.EnhancedApiCallManagerImpl - 提示词内容: \n=== 时间线生成任务 ===\n时间线名称：俄乌冲突6月时间线_segment_0_20250601_20250630\n...\n=== 输出格式要求 ===\n请返回JSON格式的事件列表，每个事件必须包含以下字段：\n- id: 事件唯一标识\n- title: 事件标题（简洁明了）\n- description: 事件详细描述\n- eventTime: 事件发生时间（ISO格式）\n- location: 事件发生地点（具体地名）\n- subject: 事件主体（人物、组织等）\n- object: 事件客体（受影响对象）\n- eventType: 事件类型（政治、经济、社会、科技等）\n- keywords: 关键词列表\n- sources: 信息来源列表\n- credibilityScore: 可信度评分（0.0-1.0）\n\n<span class=\"highlight\">❌ 缺少 latitude 和 longitude 字段要求</span>\n        </div>\n    </div>\n\n    <div class=\"test-section\">\n        <h2>🔧 解决方案</h2>\n        <p>我们需要更新数据库中的提示词模板，确保包含经纬度要求。</p>\n        \n        <div class=\"step\">\n            <h4>步骤 1: 检查当前模板状态</h4>\n            <button class=\"button\" onclick=\"checkTemplateStatus()\">检查模板状态</button>\n            <div id=\"checkResult\" class=\"result-area\">点击按钮检查当前模板状态...</div>\n        </div>\n        \n        <div class=\"step\">\n            <h4>步骤 2: 更新模板包含坐标要求</h4>\n            <button class=\"button\" onclick=\"updateTemplate()\">更新模板</button>\n            <div id=\"updateResult\" class=\"result-area\">点击按钮更新模板...</div>\n        </div>\n        \n        <div class=\"step\">\n            <h4>步骤 3: 验证更新结果</h4>\n            <button class=\"button\" onclick=\"verifyUpdate()\">验证更新</button>\n            <div id=\"verifyResult\" class=\"result-area\">点击按钮验证更新结果...</div>\n        </div>\n        \n        <div class=\"step\">\n            <h4>步骤 4: 重新加载模板缓存</h4>\n            <button class=\"button\" onclick=\"reloadCache()\">重新加载缓存</button>\n            <div id=\"reloadResult\" class=\"result-area\">点击按钮重新加载模板缓存...</div>\n        </div>\n    </div>\n\n    <div class=\"test-section\">\n        <h2>📋 API 测试端点</h2>\n        \n        <div class=\"api-test\">\n            <h4>1. 检查模板坐标状态</h4>\n            <div class=\"code-block\">\nGET http://localhost:8080/api/prompt-template/check-coordinates\n            </div>\n            <p>返回所有激活模板的坐标要求状态</p>\n        </div>\n        \n        <div class=\"api-test\">\n            <h4>2. 更新模板包含坐标</h4>\n            <div class=\"code-block\">\nPOST http://localhost:8080/api/prompt-template/update-coordinates\n            </div>\n            <p>创建包含经纬度要求的新模板</p>\n        </div>\n        \n        <div class=\"api-test\">\n            <h4>3. 获取激活模板</h4>\n            <div class=\"code-block\">\nGET http://localhost:8080/api/prompt-template/active\n            </div>\n            <p>获取所有激活的模板列表</p>\n        </div>\n        \n        <div class=\"api-test\">\n            <h4>4. 重新加载模板缓存</h4>\n            <div class=\"code-block\">\nPOST http://localhost:8080/api/prompt-template/reload\n            </div>\n            <p>重新加载模板缓存，使更新生效</p>\n        </div>\n    </div>\n\n    <div class=\"test-section\">\n        <h2>🧪 手动测试步骤</h2>\n        \n        <h3>使用 curl 命令测试</h3>\n        <div class=\"code-block\">\n# 1. 检查当前模板状态\ncurl -X GET \"http://localhost:8080/api/prompt-template/check-coordinates\"\n\n# 2. 更新模板包含坐标要求\ncurl -X POST \"http://localhost:8080/api/prompt-template/update-coordinates\"\n\n# 3. 重新加载模板缓存\ncurl -X POST \"http://localhost:8080/api/prompt-template/reload\"\n\n# 4. 验证更新结果\ncurl -X GET \"http://localhost:8080/api/prompt-template/check-coordinates\"\n\n# 5. 获取事件检索模板内容\ncurl -X GET \"http://localhost:8080/api/prompt-template/active/event_fetch\"\n        </div>\n        \n        <h3>使用 Postman 测试</h3>\n        <ol>\n            <li>导入上述 API 端点到 Postman</li>\n            <li>设置 Base URL: <code>http://localhost:8080</code></li>\n            <li>按顺序执行测试请求</li>\n            <li>检查响应结果确认更新成功</li>\n        </ol>\n    </div>\n\n    <div class=\"test-section\">\n        <h2>✅ 预期结果</h2>\n        \n        <h3>更新前的模板（缺少坐标）</h3>\n        <div class=\"code-block\">\n=== 输出格式要求 ===\n请返回JSON格式的事件列表，每个事件必须包含以下字段：\n- id: 事件唯一标识\n- title: 事件标题（简洁明了）\n- description: 事件详细描述\n- eventTime: 事件发生时间（ISO格式）\n- location: 事件发生地点（具体地名）\n- subject: 事件主体（人物、组织等）\n- object: 事件客体（受影响对象）\n- eventType: 事件类型（政治、经济、社会、科技等）\n- keywords: 关键词列表\n- sources: 信息来源列表\n- credibilityScore: 可信度评分（0.0-1.0）\n        </div>\n        \n        <h3>更新后的模板（包含坐标）</h3>\n        <div class=\"code-block\">\n=== 输出格式要求 ===\n请返回JSON格式的事件列表，每个事件必须包含以下字段：\n- id: 事件唯一标识\n- title: 事件标题（简洁明了）\n- description: 事件详细描述\n- eventTime: 事件发生时间（ISO格式）\n- location: 事件发生地点（具体地名）\n<span class=\"highlight\">- latitude: 事件发生地点的纬度（数值格式，如：39.9042）</span>\n<span class=\"highlight\">- longitude: 事件发生地点的经度（数值格式，如：116.4074）</span>\n- subject: 事件主体（人物、组织等）\n- object: 事件客体（受影响对象）\n- eventType: 事件类型（政治、经济、社会、科技等）\n- keywords: 关键词列表\n- sources: 信息来源列表\n- credibilityScore: 可信度评分（0.0-1.0）\n\n=== 重要要求 ===\n<span class=\"highlight\">1. **必须提供准确的经纬度坐标**：每个事件都必须包含latitude和longitude字段</span>\n<span class=\"highlight\">2. 经纬度必须是数值格式（如：39.9042），不能是字符串</span>\n<span class=\"highlight\">3. 如果无法确定精确坐标，请提供该地区的中心坐标或主要城市坐标</span>\n        </div>\n    </div>\n\n    <div class=\"test-section\">\n        <h2>🔍 验证检查清单</h2>\n        <ul>\n            <li>☐ 模板更新 API 调用成功</li>\n            <li>☐ 新模板包含 latitude 和 longitude 字段要求</li>\n            <li>☐ 模板缓存重新加载成功</li>\n            <li>☐ 检查状态 API 显示模板包含坐标要求</li>\n            <li>☐ 创建新时间线时使用更新后的模板</li>\n            <li>☐ API 响应包含经纬度数据</li>\n            <li>☐ 数据库中新事件包含坐标信息</li>\n        </ul>\n    </div>\n\n    <div class=\"test-section\">\n        <h2>🚨 故障排除</h2>\n        \n        <h3>如果模板更新失败</h3>\n        <ul>\n            <li>检查应用是否正常运行</li>\n            <li>确认数据库连接正常</li>\n            <li>查看应用日志中的错误信息</li>\n            <li>尝试手动执行 SQL 更新语句</li>\n        </ul>\n        \n        <h3>如果缓存未更新</h3>\n        <ul>\n            <li>调用重新加载缓存 API</li>\n            <li>重启应用服务</li>\n            <li>检查模板服务的缓存机制</li>\n        </ul>\n        \n        <h3>如果仍然没有坐标</h3>\n        <ul>\n            <li>确认使用的是更新后的模板</li>\n            <li>检查事件解析逻辑是否正确</li>\n            <li>验证 API 响应格式</li>\n            <li>查看详细的调试日志</li>\n        </ul>\n    </div>\n\n    <script>\n        const baseUrl = 'http://localhost:8080';\n        \n        async function makeRequest(url, method = 'GET') {\n            try {\n                const response = await fetch(url, {\n                    method: method,\n                    headers: {\n                        'Content-Type': 'application/json'\n                    }\n                });\n                \n                if (!response.ok) {\n                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n                }\n                \n                const data = await response.json();\n                return JSON.stringify(data, null, 2);\n            } catch (error) {\n                return `错误: ${error.message}`;\n            }\n        }\n        \n        async function checkTemplateStatus() {\n            const result = document.getElementById('checkResult');\n            result.textContent = '正在检查模板状态...';\n            \n            const response = await makeRequest(`${baseUrl}/api/prompt-template/check-coordinates`);\n            result.textContent = response;\n        }\n        \n        async function updateTemplate() {\n            const result = document.getElementById('updateResult');\n            result.textContent = '正在更新模板...';\n            \n            const response = await makeRequest(`${baseUrl}/api/prompt-template/update-coordinates`, 'POST');\n            result.textContent = response;\n        }\n        \n        async function verifyUpdate() {\n            const result = document.getElementById('verifyResult');\n            result.textContent = '正在验证更新结果...';\n            \n            const response = await makeRequest(`${baseUrl}/api/prompt-template/check-coordinates`);\n            result.textContent = response;\n        }\n        \n        async function reloadCache() {\n            const result = document.getElementById('reloadResult');\n            result.textContent = '正在重新加载缓存...';\n            \n            const response = await makeRequest(`${baseUrl}/api/prompt-template/reload`, 'POST');\n            result.textContent = response;\n        }\n        \n        // 页面加载时的提示\n        console.log('📝 提示词模板更新测试页面已加载');\n        console.log('🎯 请确保应用服务正在运行在 http://localhost:8080');\n        console.log('🔧 按照步骤依次执行测试');\n    </script>\n</body>\n</html>"
}
</invoke>