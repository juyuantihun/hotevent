# 🔍 诊断"事件数量为0"问题指南

## 🚨 问题现象

- DeepSeek API调用成功（`success: true`）
- 响应时间正常（约2秒）
- 但是事件数量为0（`eventCount: 0`）

## 🛠️ 立即诊断步骤

### 步骤1: 使用原始API测试

访问联网搜索管理页面：
```
http://localhost:8080/websearch
```

1. 在测试区域输入：`伊以战争时间线`
2. 点击 **"测试原始API"** 按钮
3. 查看详细的响应分析

### 步骤2: 分析响应类型

根据原始API测试结果，可能的情况：

#### 情况A: Markdown格式响应
```
类型: markdown_json
描述: Markdown代码块中的JSON
```
**解决方案**: 系统已经支持解析markdown格式，但可能解析逻辑有问题。

#### 情况B: 纯文本响应
```
类型: plain_text
描述: 纯文本响应
包含事件: 是
包含JSON: 否
```
**解决方案**: DeepSeek返回了文本而非JSON，需要启用文本解析功能。

#### 情况C: JSON格式但无events字段
```
类型: json_object
有events字段: 否
```
**解决方案**: DeepSeek返回的JSON格式与期望不符。

#### 情况D: 空响应或错误
```
类型: empty
描述: 响应为空
```
**解决方案**: API调用失败或API密钥问题。

### 步骤3: 检查API密钥

确认DeepSeek API密钥是否正确配置：

1. 检查环境变量：
   ```bash
   echo $DEEPSEEK_API_KEY
   ```

2. 检查配置文件中的API密钥是否有效

3. 访问DeepSeek官网确认API密钥状态

### 步骤4: 查看详细日志

运行日志检查脚本：
```cmd
.\scripts\check-logs.bat
```

寻找以下关键信息：
- `=== DeepSeek响应调试开始 ===`
- `原始响应内容:`
- `JSON解析失败:`
- `事件解析结果为空`

## 🔧 常见问题及解决方案

### 问题1: DeepSeek返回Markdown格式

**现象**: 响应包含 ```json 代码块

**解决方案**: 系统已支持，如果仍然解析失败，可能是代码块提取逻辑问题。

### 问题2: DeepSeek返回纯文本

**现象**: 响应是描述性文本，不是JSON

**解决方案**: 
1. 改进提示词，更明确地要求JSON格式
2. 启用文本解析功能（系统已支持）

### 问题3: API密钥无效

**现象**: API调用失败或返回错误

**解决方案**:
1. 检查API密钥是否正确
2. 确认API密钥是否有足够配额
3. 检查网络连接

### 问题4: 联网搜索未启用

**现象**: DeepSeek没有使用联网搜索

**解决方案**:
1. 确认配置中 `web-search.enabled: true`
2. 检查API是否支持联网搜索功能

## 📋 完整诊断清单

- [ ] 运行原始API测试
- [ ] 分析响应类型和内容
- [ ] 检查API密钥有效性
- [ ] 查看应用日志
- [ ] 确认联网搜索配置
- [ ] 测试不同的查询内容
- [ ] 检查网络连接
- [ ] 验证DeepSeek API状态

## 🚀 快速修复尝试

### 修复1: 重新配置API密钥
```bash
export DEEPSEEK_API_KEY=your_new_api_key
```

### 修复2: 调整搜索参数
```yaml
app:
  deepseek:
    web-search:
      max-results: 5
      search-timeout: 60000
```

### 修复3: 使用不同的查询
尝试更简单的查询，如：
- "最新新闻"
- "科技新闻"
- "国际新闻"

### 修复4: 检查模型支持
确认使用的模型支持联网搜索：
```yaml
app:
  deepseek:
    model: deepseek-chat  # 确认模型名称正确
```

## 📞 获取帮助

如果问题仍然存在，请提供：

1. **原始API测试结果**（完整的响应分析）
2. **应用日志**（包含DeepSeek相关的调试信息）
3. **配置信息**（脱敏后的API密钥前几位）
4. **网络环境**（是否使用代理等）

---

**现在请按照步骤1开始诊断，使用"测试原始API"功能！** 🔍