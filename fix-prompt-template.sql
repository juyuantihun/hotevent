-- 修复提示词模板，添加经纬度要求\n-- 执行前请先备份数据库\n\n-- 1. 查看当前的事件检索模板\nSELECT \n    id,\n    template_name,\n    template_type,\n    is_active,\n    CASE \n        WHEN template_content LIKE '%latitude%' THEN '✓ 包含坐标要求'\n        ELSE '✗ 缺少坐标要求'\n    END as coordinate_status,\n    created_at\nFROM prompt_template \nWHERE template_type = 'event_fetch' \nORDER BY created_at DESC;\n\n-- 2. 禁用旧的不包含坐标要求的模板\nUPDATE prompt_template \nSET is_active = 0,\n    updated_at = NOW()\nWHERE template_type = 'event_fetch' \nAND is_active = 1\nAND template_content NOT LIKE '%latitude%';\n\n-- 3. 插入包含经纬度要求的新模板\nINSERT INTO prompt_template (\n    template_name,\n    template_type,\n    template_content,\n    is_active,\n    created_at,\n    updated_at\n) VALUES (\n    '事件检索模板（含坐标）',\n    'event_fetch',\n    '=== 时间线生成任务 ===\n时间线名称：{timelineName}\n时间线描述：{timelineDescription}\n\n=== 当前时间段信息 ===\n时间范围：{startTime} 至 {endTime}\n目标地区：{regions}\n预期事件数量：300个\n\n=== 任务要求 ===\n请为上述时间线主题，在指定的时间段和地区范围内，搜索和获取相关的热点事件信息。\n重点关注与时间线主题相关的重要事件、新闻、发展动态等。\n\n=== 功能配置 ===\n- 启用事件去重：避免重复事件\n- 启用字典管理：使用标准化术语\n- 启用关系分析：分析事件间关联\n\n=== 输出格式要求 ===\n请返回JSON格式的事件列表，每个事件必须包含以下字段：\n- id: 事件唯一标识\n- title: 事件标题（简洁明了）\n- description: 事件详细描述\n- eventTime: 事件发生时间（ISO格式）\n- location: 事件发生地点（具体地名）\n- latitude: 事件发生地点的纬度（数值格式，如：39.9042）\n- longitude: 事件发生地点的经度（数值格式，如：116.4074）\n- subject: 事件主体（人物、组织等）\n- object: 事件客体（受影响对象）\n- eventType: 事件类型（政治、经济、社会、科技等）\n- keywords: 关键词列表\n- sources: 信息来源列表\n- credibilityScore: 可信度评分（0.0-1.0）\n\nJSON格式示例：\n{\n  \"events\": [\n    {\n      \"id\": \"event_001\",\n      \"title\": \"事件标题\",\n      \"description\": \"事件详细描述\",\n      \"eventTime\": \"2024-01-15T10:30:00Z\",\n      \"location\": \"北京市\",\n      \"latitude\": 39.9042,\n      \"longitude\": 116.4074,\n      \"subject\": \"事件主体\",\n      \"object\": \"事件客体\",\n      \"eventType\": \"政治\",\n      \"keywords\": [\"关键词1\", \"关键词2\"],\n      \"sources\": [\"来源1\", \"来源2\"],\n      \"credibilityScore\": 0.85\n    }\n  ]\n}\n\n=== 重要要求 ===\n1. **必须提供准确的经纬度坐标**：每个事件都必须包含latitude和longitude字段\n2. 经纬度必须是数值格式（如：39.9042），不能是字符串\n3. 如果无法确定精确坐标，请提供该地区的中心坐标或主要城市坐标\n4. 返回的JSON必须格式正确，可以直接解析\n5. 请严格按照上述格式返回，不要添加任何额外的文字说明\n\n请确保返回的事件信息准确、及时、相关，并且符合指定的时间和地区范围。',\n    1,\n    NOW(),\n    NOW()\n);\n\n-- 4. 验证更新结果\nSELECT \n    id,\n    template_name,\n    template_type,\n    is_active,\n    CASE \n        WHEN template_content LIKE '%latitude%' THEN '✓ 包含坐标要求'\n        ELSE '✗ 缺少坐标要求'\n    END as coordinate_status,\n    created_at\nFROM prompt_template \nWHERE template_type = 'event_fetch' \nORDER BY created_at DESC;\n\n-- 5. 查看新模板的部分内容（验证）\nSELECT \n    template_name,\n    SUBSTRING(template_content, 1, 500) as content_preview\nFROM prompt_template \nWHERE template_type = 'event_fetch' \nAND is_active = 1\nAND template_content LIKE '%latitude%';\n\n-- 6. 统计所有模板的坐标要求状态\nSELECT \n    template_type,\n    COUNT(*) as total_templates,\n    SUM(CASE WHEN is_active = 1 THEN 1 ELSE 0 END) as active_templates,\n    SUM(CASE WHEN template_content LIKE '%latitude%' THEN 1 ELSE 0 END) as templates_with_coordinates\nFROM prompt_template \nGROUP BY template_type\nORDER BY template_type;"
}
</invoke>