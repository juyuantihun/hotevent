<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>经纬度修复简化测试</title>\n    <style>\n        body {\n            font-family: 'Microsoft YaHei', sans-serif;\n            max-width: 1000px;\n            margin: 0 auto;\n            padding: 20px;\n            line-height: 1.6;\n            background: #f8f9fa;\n        }\n        .header {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            padding: 30px;\n            border-radius: 12px;\n            text-align: center;\n            margin-bottom: 30px;\n        }\n        .section {\n            background: white;\n            padding: 25px;\n            margin: 20px 0;\n            border-radius: 10px;\n            box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n            border-left: 5px solid #409eff;\n        }\n        .code-block {\n            background: #2d3748;\n            color: #e2e8f0;\n            padding: 20px;\n            border-radius: 8px;\n            overflow-x: auto;\n            font-family: 'Consolas', 'Monaco', monospace;\n            margin: 15px 0;\n            font-size: 14px;\n        }\n        .success {\n            color: #67c23a;\n            font-weight: bold;\n        }\n        .warning {\n            color: #e6a23c;\n            font-weight: bold;\n        }\n        .error {\n            color: #f56c6c;\n            font-weight: bold;\n        }\n        .highlight {\n            background: #fff3cd;\n            padding: 3px 6px;\n            border-radius: 4px;\n            font-weight: bold;\n            color: #856404;\n        }\n        .step {\n            background: #e8f5e8;\n            padding: 15px;\n            margin: 10px 0;\n            border-radius: 6px;\n            border-left: 4px solid #28a745;\n        }\n        .comparison {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 20px;\n            margin: 20px 0;\n        }\n        .before, .after {\n            padding: 15px;\n            border-radius: 6px;\n        }\n        .before {\n            background: #fef0f0;\n            border: 1px solid #fbc4c4;\n        }\n        .after {\n            background: #f0f9ff;\n            border: 1px solid #bfdbfe;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <h1>🎯 经纬度修复简化测试</h1>\n        <p>快速修复提示词模板中缺少经纬度要求的问题</p>\n    </div>\n\n    <div class=\"section\">\n        <h2>📋 问题确认</h2>\n        <p>根据日志分析，当前提示词模板缺少经纬度字段要求：</p>\n        <div class=\"comparison\">\n            <div class=\"before\">\n                <h4>❌ 当前模板（缺少坐标）</h4>\n                <div class=\"code-block\">\n=== 输出格式要求 ===\n请返回JSON格式的事件列表，每个事件必须包含以下字段：\n- id: 事件唯一标识\n- title: 事件标题（简洁明了）\n- description: 事件详细描述\n- eventTime: 事件发生时间（ISO格式）\n- location: 事件发生地点（具体地名）\n- subject: 事件主体（人物、组织等）\n- object: 事件客体（受影响对象）\n- eventType: 事件类型（政治、经济、社会、科技等）\n- keywords: 关键词列表\n- sources: 信息来源列表\n- credibilityScore: 可信度评分（0.0-1.0）\n                </div>\n            </div>\n            <div class=\"after\">\n                <h4>✅ 修复后模板（包含坐标）</h4>\n                <div class=\"code-block\">\n=== 输出格式要求 ===\n请返回JSON格式的事件列表，每个事件必须包含以下字段：\n- id: 事件唯一标识\n- title: 事件标题（简洁明了）\n- description: 事件详细描述\n- eventTime: 事件发生时间（ISO格式）\n- location: 事件发生地点（具体地名）\n<span class=\"highlight\">- latitude: 事件发生地点的纬度（数值格式，如：39.9042）</span>\n<span class=\"highlight\">- longitude: 事件发生地点的经度（数值格式，如：116.4074）</span>\n- subject: 事件主体（人物、组织等）\n- object: 事件客体（受影响对象）\n- eventType: 事件类型（政治、经济、社会、科技等）\n- keywords: 关键词列表\n- sources: 信息来源列表\n- credibilityScore: 可信度评分（0.0-1.0）\n\n<span class=\"highlight\">=== 重要要求 ===</span>\n<span class=\"highlight\">1. **必须提供准确的经纬度坐标**</span>\n<span class=\"highlight\">2. 经纬度必须是数值格式</span>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class=\"section\">\n        <h2>🔧 修复方案</h2>\n        <p>我们已经准备了完整的修复方案，包括：</p>\n        <ul>\n            <li><span class=\"success\">✓</span> 事件解析逻辑修复（已完成）</li>\n            <li><span class=\"success\">✓</span> 模拟事件坐标生成（已完成）</li>\n            <li><span class=\"warning\">⚠️</span> 提示词模板更新（需要执行）</li>\n        </ul>\n    </div>\n\n    <div class=\"section\">\n        <h2>🚀 立即修复步骤</h2>\n        \n        <div class=\"step\">\n            <h4>步骤 1: 连接数据库</h4>\n            <div class=\"code-block\">\n# 使用MySQL客户端连接\nmysql -u root -p hot_events\n\n# 或者使用其他数据库工具（如Navicat、DBeaver等）\n            </div>\n        </div>\n        \n        <div class=\"step\">\n            <h4>步骤 2: 执行修复SQL</h4>\n            <p>复制并执行以下SQL语句：</p>\n            <div class=\"code-block\">\n-- 1. 查看当前模板状态\nSELECT \n    id, template_name, template_type, is_active,\n    CASE WHEN template_content LIKE '%latitude%' THEN '✓ 包含坐标' ELSE '✗ 缺少坐标' END as status\nFROM prompt_template \nWHERE template_type = 'event_fetch' \nORDER BY created_at DESC;\n\n-- 2. 禁用旧模板\nUPDATE prompt_template \nSET is_active = 0, updated_at = NOW()\nWHERE template_type = 'event_fetch' \nAND is_active = 1\nAND template_content NOT LIKE '%latitude%';\n\n-- 3. 插入新模板（包含坐标要求）\nINSERT INTO prompt_template (\n    template_name, template_type, template_content, is_active, created_at, updated_at\n) VALUES (\n    '事件检索模板（含坐标）', 'event_fetch',\n    '=== 时间线生成任务 ===\\n时间线名称：{timelineName}\\n时间线描述：{timelineDescription}\\n\\n=== 当前时间段信息 ===\\n时间范围：{startTime} 至 {endTime}\\n目标地区：{regions}\\n预期事件数量：300个\\n\\n=== 任务要求 ===\\n请为上述时间线主题，在指定的时间段和地区范围内，搜索和获取相关的热点事件信息。\\n重点关注与时间线主题相关的重要事件、新闻、发展动态等。\\n\\n=== 功能配置 ===\\n- 启用事件去重：避免重复事件\\n- 启用字典管理：使用标准化术语\\n- 启用关系分析：分析事件间关联\\n\\n=== 输出格式要求 ===\\n请返回JSON格式的事件列表，每个事件必须包含以下字段：\\n- id: 事件唯一标识\\n- title: 事件标题（简洁明了）\\n- description: 事件详细描述\\n- eventTime: 事件发生时间（ISO格式）\\n- location: 事件发生地点（具体地名）\\n- latitude: 事件发生地点的纬度（数值格式，如：39.9042）\\n- longitude: 事件发生地点的经度（数值格式，如：116.4074）\\n- subject: 事件主体（人物、组织等）\\n- object: 事件客体（受影响对象）\\n- eventType: 事件类型（政治、经济、社会、科技等）\\n- keywords: 关键词列表\\n- sources: 信息来源列表\\n- credibilityScore: 可信度评分（0.0-1.0）\\n\\nJSON格式示例：\\n{\\n  \"events\": [\\n    {\\n      \"id\": \"event_001\",\\n      \"title\": \"事件标题\",\\n      \"description\": \"事件详细描述\",\\n      \"eventTime\": \"2024-01-15T10:30:00Z\",\\n      \"location\": \"北京市\",\\n      \"latitude\": 39.9042,\\n      \"longitude\": 116.4074,\\n      \"subject\": \"事件主体\",\\n      \"object\": \"事件客体\",\\n      \"eventType\": \"政治\",\\n      \"keywords\": [\"关键词1\", \"关键词2\"],\\n      \"sources\": [\"来源1\", \"来源2\"],\\n      \"credibilityScore\": 0.85\\n    }\\n  ]\\n}\\n\\n=== 重要要求 ===\\n1. **必须提供准确的经纬度坐标**：每个事件都必须包含latitude和longitude字段\\n2. 经纬度必须是数值格式（如：39.9042），不能是字符串\\n3. 如果无法确定精确坐标，请提供该地区的中心坐标或主要城市坐标\\n4. 返回的JSON必须格式正确，可以直接解析\\n5. 请严格按照上述格式返回，不要添加任何额外的文字说明\\n\\n请确保返回的事件信息准确、及时、相关，并且符合指定的时间和地区范围。',\n    1, NOW(), NOW()\n);\n\n-- 4. 验证修复结果\nSELECT \n    id, template_name, is_active,\n    CASE WHEN template_content LIKE '%latitude%' THEN '✓ 包含坐标' ELSE '✗ 缺少坐标' END as status\nFROM prompt_template \nWHERE template_type = 'event_fetch' \nORDER BY created_at DESC;\n            </div>\n        </div>\n        \n        <div class=\"step\">\n            <h4>步骤 3: 重启应用（可选）</h4>\n            <p>如果应用使用了模板缓存，建议重启应用以确保新模板生效：</p>\n            <div class=\"code-block\">\n# 停止当前应用（Ctrl+C）\n# 然后重新启动\nmvn spring-boot:run\n            </div>\n        </div>\n        \n        <div class=\"step\">\n            <h4>步骤 4: 测试验证</h4>\n            <div class=\"code-block\">\n# 创建新的时间线测试\ncurl -X POST \"http://localhost:8080/api/timeline/generate\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"坐标测试时间线\",\n    \"description\": \"测试经纬度修复\",\n    \"regionIds\": [1],\n    \"startTime\": \"2024-01-01T00:00:00\",\n    \"endTime\": \"2024-01-31T23:59:59\"\n  }'\n            </div>\n        </div>\n    </div>\n\n    <div class=\"section\">\n        <h2>📊 预期效果</h2>\n        <p>修复完成后，您应该看到：</p>\n        \n        <h3>1. 数据库验证</h3>\n        <div class=\"code-block\">\n-- 检查新创建的事件是否包含坐标\nSELECT id, event_title, event_location, latitude, longitude, created_at\nFROM event \nWHERE created_at >= DATE_SUB(NOW(), INTERVAL 10 MINUTE)\nORDER BY created_at DESC;\n        </div>\n        \n        <h3>2. API响应示例</h3>\n        <div class=\"code-block\">\n{\n  \"success\": true,\n  \"data\": {\n    \"events\": [\n      {\n        \"id\": \"event_1\",\n        \"title\": \"测试事件\",\n        \"location\": \"北京市\",\n        <span class=\"highlight\">\"latitude\": 39.9042,</span>\n        <span class=\"highlight\">\"longitude\": 116.4074,</span>\n        \"eventTime\": \"2024-01-15T10:30:00\"\n      }\n    ]\n  }\n}\n        </div>\n        \n        <h3>3. 日志验证</h3>\n        <p>在应用日志中，您应该看到提示词包含了经纬度要求：</p>\n        <div class=\"code-block\">\n2025-08-04 17:xx:xx [http-nio-8080-exec-x] INFO  c.h.e.s.i.EnhancedApiCallManagerImpl - 提示词内容: \n=== 输出格式要求 ===\n...\n- location: 事件发生地点（具体地名）\n<span class=\"highlight\">- latitude: 事件发生地点的纬度（数值格式，如：39.9042）</span>\n<span class=\"highlight\">- longitude: 事件发生地点的经度（数值格式，如：116.4074）</span>\n...\n        </div>\n    </div>\n\n    <div class=\"section\">\n        <h2>✅ 检查清单</h2>\n        <ul>\n            <li>☐ 数据库连接正常</li>\n            <li>☐ 执行SQL更新成功</li>\n            <li>☐ 新模板包含latitude和longitude要求</li>\n            <li>☐ 旧模板已禁用</li>\n            <li>☐ 应用重启（如需要）</li>\n            <li>☐ 创建新时间线测试</li>\n            <li>☐ 验证事件包含坐标数据</li>\n            <li>☐ 检查API响应格式</li>\n        </ul>\n    </div>\n\n    <div class=\"section\">\n        <h2>🚨 故障排除</h2>\n        \n        <h3>如果SQL执行失败</h3>\n        <ul>\n            <li>检查数据库连接和权限</li>\n            <li>确认表名和字段名正确</li>\n            <li>查看数据库错误日志</li>\n        </ul>\n        \n        <h3>如果仍然没有坐标</h3>\n        <ul>\n            <li>确认新模板已激活（is_active = 1）</li>\n            <li>重启应用清除缓存</li>\n            <li>检查事件解析逻辑是否正确</li>\n            <li>查看详细的应用日志</li>\n        </ul>\n        \n        <h3>如果需要回滚</h3>\n        <div class=\"code-block\">\n-- 恢复旧模板\nUPDATE prompt_template \nSET is_active = 1, updated_at = NOW()\nWHERE template_type = 'event_fetch' \nAND template_content NOT LIKE '%latitude%'\nORDER BY created_at DESC LIMIT 1;\n\n-- 禁用新模板\nUPDATE prompt_template \nSET is_active = 0, updated_at = NOW()\nWHERE template_type = 'event_fetch' \nAND template_content LIKE '%latitude%';\n        </div>\n    </div>\n\n    <div class=\"section\">\n        <h2>🎯 总结</h2>\n        <p>这个修复方案解决了经纬度缺失的根本问题：</p>\n        <ul>\n            <li><span class=\"success\">✓</span> <strong>提示词模板</strong>：添加了明确的经纬度字段要求</li>\n            <li><span class=\"success\">✓</span> <strong>事件解析</strong>：支持多格式坐标数据解析</li>\n            <li><span class=\"success\">✓</span> <strong>模拟数据</strong>：使用真实城市坐标</li>\n            <li><span class=\"success\">✓</span> <strong>错误处理</strong>：完整的异常处理机制</li>\n        </ul>\n        \n        <p>执行完成后，系统将能够：</p>\n        <ul>\n            <li>🌍 在API请求中明确要求返回经纬度</li>\n            <li>📍 正确解析和存储坐标信息</li>\n            <li>🗺️ 为所有新创建的事件提供地理位置</li>\n            <li>📊 支持基于地理位置的数据分析和可视化</li>\n        </ul>\n    </div>\n\n    <script>\n        console.log('🎯 经纬度修复简化测试页面已加载');\n        console.log('📋 请按照步骤执行数据库更新');\n        console.log('🔧 修复完成后重新测试时间线生成功能');\n        \n        // 显示当前时间\n        document.addEventListener('DOMContentLoaded', function() {\n            console.log('⏰ 测试开始时间:', new Date().toLocaleString());\n        });\n    </script>\n</body>\n</html>"
}
</invoke>